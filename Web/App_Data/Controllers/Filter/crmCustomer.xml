<?xml version="1.0" encoding="utf-8" ?>

<dir table="hrnv" code="stt_rec" xmlns="urn:schemas-Sthink-company:data-dir">
  <title v="Điều kiện lọc" e="Filter Condition"></title>
  <fields>
	  <field name="ten_kh">
		  <header v="Tên khách hàng" e=""></header>
	  </field>
	  <field name="ma_so_thue" width="100" >
		  <header v="Mã số thuế" e="Tax Code"></header>
		  <clientScript><![CDATA[onchange="onChange$Voucher$mst(this);"]]></clientScript>
	  </field>	  
	  <field name="dia_chi" width="300" >
		  <header v="Địa chỉ" e="Address"></header>
	  </field>
	  <field name="dien_thoai" width="100" >
		  <header v="Điện thoại" e="Tax Code"></header>
	  </field>
	  <field name="tinh_thanh" width="100" >
		  <header v="Tỉnh thành" e="Tax Code"></header>
	  </field>
	  <field name="ma_bp" onDemand="true">
		  <header v="Bộ phận" e="Department"></header>
		  <items style="AutoComplete" controller="hrDepartment" reference="ten_bp%l" key="status = '1'" check="1 = 1"/>
	  </field>
	  <field name="ten_bp%l" readOnly="true">
		  <header v="" e=""></header>
	  </field>
	  <field name="nh_kh1" clientDefault="Default">
		  <header v="Loại khách" e="Group 1, 2, 3"></header>
		  <items style="AutoComplete" controller="CustomerGroup" reference="ten_nh_kh1%l" key="loai_nh = 1 and status = '1'" check="loai_nh = 1" information="ma_nh$dmnhkh.ten_nh%l"/>
	  </field>
	  <field name="ten_nh_kh1%l" readOnly="true" external="true" clientDefault="Default" defaultValue="''" hidden="true">
		  <header v="" e=""></header>
	  </field>
	  <field name="nh_kh2" clientDefault="Default">
		  <header v="Lĩnh vực" e=""></header>
		  <items style="AutoComplete" controller="CustomerGroup" reference="ten_nhom%l" key="loai_nh = 2 and status = '1'" check="loai_nh = 2" information="ma_nh$dmnhkh.ten_nh%l"/>
	  </field>
	  <field name="ten_nhom%l" readOnly="true" external="true" clientDefault="Default" defaultValue="''">
		  <header v="" e=""></header>
	  </field>
	  <field name="nh_kh3" clientDefault="Default">
		  <header v="Nguồn" e=""></header>
		  <items style="AutoComplete" controller="CustomerGroup" reference="ten_nh_kh3%l" key="loai_nh = 3 and status = '1'" check="loai_nh = 3" information="ma_nh$dmnhkh.ten_nh%l"/>
	  </field>
	  <field name="ten_nh_kh3%l" readOnly="true" external="true" clientDefault="Default" defaultValue="''" hidden="true">
		  <header v="" e=""></header>
	  </field>
	  <field name="ma_nvbh" width="100">
		  <header v="Nv bán hàng" e="Sales Employee"></header>
		  <items style="AutoComplete" controller="SalesEmployee" reference="ten_nvbh%l" key="status = '1' and dbo.Crm_getmavn(ma_nvbh,@@userID) = 1" check="1=1" information="ma_nvbh$dmnvbh.ten_nvbh%l"/>
	  </field>
	  <field name="ten_nvbh%l" readOnly="true" external="true" defaultValue="''" hidden="true">
		  <header v="" e=""></header>
	  </field>
	  <field name="nv_cd_yn" dataFormatString="1, 0" clientDefault="1" align="right">
		  <header v="Hiển thị cấp dưới" e="With Sub-department"></header>
		  <footer v="1 - Có, 0 - Không" e="1 - Yes, 0 - No"></footer>
		  <items style="Mask"/>
	  </field>
	  <field name="status" dataFormatString="1, 0, *" clientDefault="1" align="right">
		  <header v="Trạng thái" e="Status"></header>
		  <footer v="1 - Còn sử dụng, 0 - Không còn sử dụng, * - Tất cả" e="1 - Working, 0 - Left, * - All"></footer>
		  <items style="Mask"/>
	  </field>
  </fields>

  <views>
    <view id="Dir">
		<item value="120, 30, 70, 100, 100, 130, 0"/>
		<item value="1100: [ten_kh].Label, [ten_kh]"/>
		<item value="1100: [ma_so_thue].Label, [ma_so_thue]"/>
		<item value="1100: [dia_chi].Label, [dia_chi]"/>
		<item value="1100: [dien_thoai].Label, [dien_thoai]"/>
		<item value="1100: [tinh_thanh].Label, [tinh_thanh]"/>
		<item value="1101: [ma_bp].Label, [ma_bp], [ten_bp%l]"/>
		<item value="1101: [nh_kh1].Label, [nh_kh1], [ten_nh_kh1%l] "/>
		<item value="1101: [nh_kh2].Label, [nh_kh2], [ten_nhom%l] "/>
		<item value="1101: [nh_kh3].Label, [nh_kh3], [ten_nh_kh3%l] "/>
		<item value="1101: [ma_nvbh].Label, [ma_nvbh], [ten_nvbh%l]"/>
		<item value="11100: [nv_cd_yn].Label, [nv_cd_yn], [nv_cd_yn].Description"/>
		<item value="11100: [status].Label, [status], [status].Description"/>
    </view>
  </views>

  <commands>
    <command event="Loading">
      <text>
        <![CDATA[
select 'active$EmployeeFilter$(this);' as message
return
]]>
      </text>
    </command>
    <command event="Closing">
      <text>
        <![CDATA[
select 'close$EmployeeFilter$(this);' as message
return
]]>
      </text>
    </command>
  </commands>

  <script>
    <text>
      <![CDATA[
function onChange$EmployeeFilter$Tab(sender, e) {sender.parentForm.focusWhenTabChanged(['ngay_vao1', 'hon_nhan']);}
function active$EmployeeFilter$(sender) {
  sender.add_onResponseComplete(on$EmployeeFilter$ResponseComplete);
  //sender._tabContainer.add_activeTabChanged(onChange$EmployeeFilter$Tab);
  //sender._tabContainer._loaded = true;
}
function close$EmployeeFilter$(sender) {
  //if (sender._tabContainer) try {sender._tabContainer.remove_activeTabChanged(onChange$EmployeeFilter$Tab);} catch (ex) {}
  try {sender.remove_onResponseComplete(on$EmployeeFilter$ResponseComplete);} catch (ex) {}
}
function on$EmployeeFilter$ResponseComplete(sender, e) {
  var f = e.object, context = e.type.Context, result = e.type.Result;
  switch (context) {
    case 'Checking':
      var g = f.grid;
      saveFilterMemvar(f);
      g._hideViewPanel = true;
  }
}
function saveFilterMemvar(f) {
  var g = f.grid, view = g._view;
  g._stringValue = []; g._dateTimeValue = [];
  var f1 = view._stringFields, f2 = view._dateTimeFields;
  for (var i = 1; i < f1.length; i++) g._stringValue[i] = f.getItemValue($func.trim(f1[i]));
  for (var i = 0; i < f2.length; i++) g._dateTimeValue[i] = f.getItemValue($func.trim(f2[i]));
}
]]>
    </text>
  </script>

</dir>