<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE grid [
	<!ENTITY XMLWhenReportLoading SYSTEM "..\Include\XML\WhenReportLoading.xml">
	<!ENTITY XMLWhenReportClosing SYSTEM "..\Include\XML\WhenReportClosing.xml">
	<!ENTITY XMLStandardReportToolbar SYSTEM "..\Include\XML\StandardReportToolbar.xml">

	<!ENTITY JavascriptReportInit SYSTEM "..\Include\Javascript\ReportInit.txt">
]>

<grid table="vcrmCongNo" code="sysorder" order="sysorder" type="Voucher" filter="ma_dvcs = @@unit" xmlns="urn:schemas-Sthink-company:data-grid">
	<title v="" e=""></title>
	<subTitle v="" e=""></subTitle>

	<fields>
		<field name="sysorder" width="0" hidden="true">
			<header v="" e=""></header>
		</field>
		<field name="ngay_ct" type="DateTime" dataFormatString="@datetimeFormat" width ="80" allowSorting="true" allowFilter="true">
			<header v="Ngày ct" e="VC. Date" />
		</field>
		<field name="ma_ct0" width="60" allowSorting="true" allowFilter="true" hyperlinkFormatString="~/AppHandler/Voucher.ashx Query: {Name: '[ma_ct]', Value: '[stt_rec]'}, Script: 'beforeDrillDown(this);'">
			<header v="Mã ct" e="VC. Code"></header>
		</field>
		<field name="so_ct" width="80" allowSorting="true" allowFilter="true" align="right">
			<header v="Số ct" e="Voucher No."></header>
		</field>
		<field name="dien_giai" width="300" allowSorting="true" allowFilter="true">
			<header v="Diễn giải" e="Description"></header>
		</field>
		<field name="tk_du" width="100" allowSorting="true" allowFilter="true">
			<header v="Tk đối ứng" e="Ref. Account"></header>
		</field>

		<field name="so_luong" type="Decimal" width="100" dataFormatString="@quantityViewFormat" allowSorting="true" aggregate="Sum">
			<header v="Số lượng" e="Quantity"></header>
		</field>
		<field name="gia" type="Decimal" width="100" dataFormatString="@foreignCurrencyAmountViewFormat" allowSorting="true">
			<header v="Giá" e="Price"></header>
		</field>
		<field name="tien" type="Decimal" width="120" dataFormatString="@baseCurrencyAmountViewFormat" allowSorting="true" aggregate="Sum">
			<header v="Tiền" e="Amount"></header>
		</field>
		<field name="ck" type="Decimal" width="100" dataFormatString="@baseCurrencyPriceViewFormat" allowSorting="true">
			<header v="Tiền chiết khấu" e="Price"></header>
		</field>
		<field name="thanhtoan" type="Decimal" width="120" dataFormatString="@baseCurrencyAmountViewFormat" allowSorting="true" aggregate="Sum">
			<header v="Phải thanh toán" e="Amount"></header>
		</field>
		<field name="ps_no" type="Decimal" width="120" dataFormatString="@baseCurrencyAmountViewFormat" allowSorting="true" aggregate="Sum">
			<header v="Phát sinh nợ" e="Debit Amount"></header>
		</field>
		<field name="ps_co" type="Decimal" width="120" dataFormatString="@baseCurrencyAmountViewFormat" allowSorting="true" aggregate="Sum">
			<header v="Phát sinh có" e="Credit Amount"></header>
		</field>
		<field name="du_no" type="Decimal" width="120" dataFormatString="@baseCurrencyAmountViewFormat" allowSorting="true" aggregate="Sum">
			<header v="Dư nợ" e="Debit Balance"></header>
		</field>
		<field name="du_co" type="Decimal" width="120" dataFormatString="@baseCurrencyAmountViewFormat" allowSorting="true" aggregate="Sum">
			<header v="Dư có" e="Credit Balance"></header>
		</field>
		<field name="ty_gia_ck" type="Decimal" width="100" dataFormatString="@exchangeRateViewFormat" allowSorting="true">
			<header v="Tỷ giá ck" e="Exchange Rate"></header>
		</field>

		<field name="ma_vv" width="100" allowSorting="true" allowFilter="true">
			<header v="Vụ việc" e="Job"></header>
		</field>
		<field name="ma_ct" width="0" hidden="true">
			<header v="" e=""></header>
		</field>
		<field name="stt_rec" width="0" hidden="true">
			<header v="" e=""></header>
		</field>

	</fields>

	<views>
		<view id="Grid">
			<field name="sysorder"/>
			<field name="ngay_ct"/>
			<field name="ma_ct0"/>
			<field name="so_ct"/>
			<field name="dien_giai"/>
			<field name="tk_du"/>

			<field name="so_luong"/>
			<field name="gia"/>
			<field name="tien"/>
			<field name="ck"/>
			<field name="thanhtoan"/>
			<field name="ps_no"/>
			<field name="ps_co"/>
			<field name="du_no"/>
			<field name="du_co"/>
			
			<field name="ty_gia_ck"/>
			<field name="ma_vv"/>

			<field name="ma_ct"/>
			<field name="stt_rec"/>

		</view>
	</views>

	<commands>
		&XMLWhenReportLoading;
		&XMLWhenReportClosing;
	</commands>

	<script>
		<text>
			<![CDATA[
function load$GridReport$(g) {g.add_onRender(on$GridReport$Render);}
function dispose$GridReport$(g) {try {g.remove_onRender(on$GridReport$Render);} catch (ex) {}}
function on$GridReport$Render(sender, eventArgs) {
  var g = eventArgs.grid;  
  if (g._hiddenFields) {    
    var a = g._hiddenFields, h = '';
    for (var i = 0; i < a.length; i++) {
      setGridHiddenFields(g, a[i].Fields, a[i].Value);
      if (a[i].Value) h += (h == '' ? '' : ',') + a[i].Fields;
    }
    g._externalHiddenFields = h;
  }
}
function setGridHiddenFields(g, c, v) {
  var a = c.split(',');
  for (var i = 0; i < a.length; i++) {    
    g._setColumnVisible(g._getColumnOrder($func.trim(a[i])), !v);
  }
}
function beforeDrillDown(g) {g._args.cancelEvent = !($func.trim(g._getItemValue(g._activeRow, g._activeColumn)));}
function formatDateView(c) {return String.format('{0}/{1}/{2}', c.substring(6, 8), c.substring(4, 6), c.substring(0, 4));}
]]>
		</text>
	</script>

	<queries>
		<query event="Finding">
			<text>
				<![CDATA[
	
declare @d smalldatetime, @DateFrom smalldatetime, @DateTo smalldatetime, @tk varchar(33), @Type TINYINT
select @d = getdate(), @tk = '131', @Type = 1
SELECT @DateTo = DATEFROMPARTS(YEAR(@d), MONTH(@d), DAY(@d)), @DateFrom = DATEADD(DAY, -6, @DateTo)
exec crmrs_rptDCCustomer @DateFrom, @DateTo, @@unit, @tk, @ma_kh, @@language, 1, 0, @Type, @@userID, @@admin, @@textExternal

		]]>
			</text>
		</query>
	</queries>
	<toolbar>
		<!--<button command="Search">
			<title v="Toolbar.Search" e="Toolbar.Search"></title>
		</button>
		<button command="Print">
			<title v="Toolbar.Print" e="Toolbar.Print"></title>
		</button>-->
		<button command="Export">
			<title v="Toolbar.Export" e="Toolbar.Export"></title>
		</button>
		<button command="Aggregate">
			<title v="Toolbar.Aggregate" e="Toolbar.Aggregate"></title>
		</button>
		<button command="Seprate">
			<title v="-" e="-"></title>
		</button>
		<button command="Freeze">
			<title v="Toolbar.Freeze" e="Toolbar.Freeze"></title>
		</button>
	</toolbar>

</grid>